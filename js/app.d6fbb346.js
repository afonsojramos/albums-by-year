(function(){"use strict";var e={930:function(e,t,s){var a=s(5471),o=function(){var e=this,t=e._self._c;return t("div",{class:{app:!0,desktop:e.desktop}},[t("div",{staticClass:"header"},[t("div",{staticClass:"theme-controls",on:{click:e.changeTheme}},[e._v(" Theme "),t("font-awesome-icon",{staticClass:"icon",attrs:{icon:e.theme.icon,title:e.theme.label}})],1),t("div",{staticClass:"title"},[e._v("Albums By Year")]),e.installPromptEvent?t("div",{staticClass:"install-button",on:{click:e.install}},[e._v(" Install "),t("font-awesome-icon",{staticClass:"icon",attrs:{icon:"download",title:"Install"}})],1):e._e()]),t("main",[e.authorised?t("Library",{ref:"library",attrs:{access_token:e.access_token},on:{loaded:function(t){e.refreshing=!1}}}):t("div",{staticClass:"login"},[t("h1",{staticClass:"title"},[e._v("Albums By Year")]),t("p",{staticClass:"preface"},[e._v(" See your saved albums on spotify, categorised by year! ")]),t("a",{staticClass:"auth",attrs:{href:e.authoriseURL,target:"_self"}},[e._v("LOG IN WITH SPOTIFY")])])],1),t("footer",[e.authorised?t("ul",{staticClass:"footer-buttons"},[t("li",{staticClass:"logout-button",on:{click:e.logout}},[t("font-awesome-icon",{staticClass:"icon",attrs:{icon:"sign-out-alt",title:"Log Out"}}),e._v(" Log Out ")],1),t("li",{staticClass:"refresh-button",class:{offline:!e.online},on:{click:e.refresh}},[e.online?t("font-awesome-icon",{class:{icon:!0,"refreshing-icon":e.refreshing},attrs:{icon:"sync-alt",title:"Refresh"}}):t("font-awesome-layers",{staticClass:"icon"},[t("font-awesome-icon",{attrs:{icon:"wifi"}}),t("font-awesome-icon",{attrs:{icon:"slash"}})],1),e._v(" Refresh ")],1)]):e._e(),t("ul",[t("li",[t("font-awesome-icon",{staticClass:"icon",attrs:{icon:["fab","github"]}}),t("a",{attrs:{href:"https://github.com/TheTeaCat/albums-by-year/"}},[e._v("GitHub")])],1),e._m(0)])])])},i=[function(){var e=this,t=e._self._c;return t("li",[e._v("Made by "),t("a",{attrs:{href:"http://rainosullivan.com/"}},[e._v("Josh")])])}],n=(s(4114),s(8111),s(7588),s(1701),s(4335)),r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"library"},[e.loaded?t("div",[t("h1",{staticClass:"library-header"},[t("a",{staticClass:"username",attrs:{href:e.profile.external_urls.spotify}},[e._v(e._s(e.profile.display_name))]),e._v(e._s("s"==e.profile.display_name[e.profile.display_name.length-1]?"'":"'s")+" saved albums, by year"),t("span",[e._v("!")])]),t("ToggleGroup",{attrs:{options:e.album_types,title:"Release Types"}}),t("div",{staticClass:"searchbox-cont"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchBoxContent,expression:"searchBoxContent"}],class:{searchbox:!0,populated:""!=e.searchBoxContent},attrs:{placeholder:"Search..."},domProps:{value:e.searchBoxContent},on:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.updateSearchQuery.apply(null,arguments)},e.searchQueryChange],input:function(t){t.target.composing||(e.searchBoxContent=t.target.value)}}}),e.searchBoxContent!=e.search_query||""==e.searchBoxContent?t("font-awesome-icon",{staticClass:"icon fa-fw",attrs:{icon:"search"},on:{click:e.updateSearchQuery}}):t("font-awesome-icon",{staticClass:"icon fa-fw",attrs:{icon:"times"},on:{click:e.clearSearchQuery}})],1),t("ol",e._l(e.sortedAlbumYears,(function(s){return t("Year",{key:s,attrs:{year:s,albums:e.albumsByYear[s].albums,album_types:e.album_types,search_query:e.search_query},on:{filtered:t=>{e.albumsByYear[s].empty=0==t,e.checkAlbumsShown()}}})})),1),t("h2",{directives:[{name:"show",rawName:"v-show",value:0==e.loadedAlbums.length,expression:"loadedAlbums.length == 0"}],staticClass:"empty-notice"},[e._v(" You haven't got any saved albums! ")]),t("h2",{directives:[{name:"show",rawName:"v-show",value:e.no_albums_shown,expression:"no_albums_shown"}],staticClass:"empty-notice"},[e._v(" None of your albums match these filters! ")])],1):t("div",{staticClass:"loading"},[t("h1",{staticClass:"loading-title"},[e._v("Loading")]),t("p",{staticClass:"album-count"},[e._v(e._s(e.loadedAlbums)+" albums")])])])},l=[],c=(s(1148),function(){var e=this,t=e._self._c;return t("ul",e._l(Object.keys(e.options),(function(s){return t("li",{key:s},[t("Toggle",{staticClass:"toggle",attrs:{value:e.options[s].show},on:{change:function(t){e.options[s].show=!e.options[s].show}}}),e._v(" "+e._s(e.options[s].display)+" ")],1)})),0)}),u=[],h=function(){var e=this,t=e._self._c;return t("label",{staticClass:"switch"},[t("input",{attrs:{type:"checkbox"},domProps:{checked:e.value},on:{click:function(t){return e.$emit("change")}}}),t("span",{staticClass:"slider"})])},m=[],d={props:["value"]},b=d,p=s(1656),f=(0,p.A)(b,h,m,!1,null,"0b2d36a9",null),y=f.exports,v={components:{Toggle:y},props:["title","options"]},_=v,w=(0,p.A)(_,c,u,!1,null,"09f9e55a",null),g=w.exports,C=function(){var e=this,t=e._self._c;return t("li",{directives:[{name:"show",rawName:"v-show",value:e.visibleAlbums>0,expression:"visibleAlbums > 0"}],staticClass:"year"},[t("h2",{staticClass:"year-header",on:{click:function(t){e.expanded=!e.expanded}}},[t("font-awesome-icon",{class:{icon:!0,expanded:e.expanded},attrs:{icon:e.expanded?"minus":"plus"}}),e._v(" "+e._s(e.year)+" "),t("span",[e._v("("+e._s(e.visibleAlbums)+")")])],1),t("ol",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}],staticClass:"albums-list"},e._l(e.sortedAlbums,(function(s){return t("Album",{directives:[{name:"show",rawName:"v-show",value:e.albumShown(s),expression:"albumShown(a)"}],key:s.album.id,attrs:{album:s}})})),1)])},k=[],x=(s(2489),s(3579),function(){var e=this,t=e._self._c;return t("li",{staticClass:"album"},[e.lazyCoverString&&!e.albumCoverLoaded?t("img",{attrs:{src:"data:image/jpeg;base64,"+e.lazyCoverString}}):e._e(),e.online||e.albumCoverLoaded?t("img",{directives:[{name:"show",rawName:"v-show",value:e.albumCoverLoaded,expression:"albumCoverLoaded"}],attrs:{src:e.albumCover},on:{load:function(t){e.albumCoverLoaded=!0}}}):e._e(),t("div",{staticClass:"album-title"},[t("a",{attrs:{href:e.album.album.external_urls.spotify}},[e._v(e._s(e.album.album.name))])]),t("ul",{staticClass:"artists-list"},e._l(e.album.album.artists,(function(s){return t("li",{key:s.id},[t("a",{attrs:{href:s.external_urls.spotify}},[e._v(e._s(s.name))])])})),0),t("div",{staticClass:"album-release-date"},[e._v(e._s(e.release_date))]),t("button",{staticClass:"copy-button",class:{copied:e.showCopiedState},attrs:{title:e.copyButtonTitle},on:{click:e.copyAlbumInfo}},[t("font-awesome-icon",{attrs:{icon:e.copyButtonIcon}}),e._v(" "+e._s(e.copyButtonText)+" ")],1)])}),A=[],S={props:["album"],data(){return{albumCover:null,lazyCoverString:"",albumCoverLoaded:!1,online:!1,showCopiedState:!1}},computed:{release_date(){switch(this.album.album.release_date_precision){case"year":return this.album.album.release_date.split("-")[0];case"month":return this.album.album.release_date.split("-").slice(0,2).join("/");case"day":return this.album.album.release_date.replace(/-/g,"/");default:return""}},copyButtonIcon(){return this.showCopiedState?"check":"copy"},copyButtonText(){return this.showCopiedState?"Copied!":"Copy"},copyButtonTitle(){return this.showCopiedState?"Album info copied to clipboard":"Copy album info"}},methods:{async copyAlbumInfo(){const e=this.album.album.artists.length>0?this.album.album.artists[0].name:"";let t="";if(this.album.album.images&&this.album.album.images.length>0){const e=this.album.album.images.slice().sort(((e,t)=>Math.abs(e.width*e.height-9e4)-Math.abs(t.width*t.height-9e4)));t=e[0].url}const s={title:this.album.album.name,artist:e,image:t,url:this.album.album.external_urls.spotify},a=JSON.stringify(s,null,8);try{await navigator.clipboard.writeText(a),this.showCopiedState=!0,setTimeout((()=>{this.showCopiedState=!1}),2e3)}catch(o){console.error("Failed to copy: ",o),this.fallbackCopyTextToClipboard(a)}},fallbackCopyTextToClipboard(e){const t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),this.showCopiedState=!0,setTimeout((()=>{this.showCopiedState=!1}),2e3)}catch(s){console.error("Fallback: Could not copy text: ",s)}document.body.removeChild(t)}},async mounted(){this.online=navigator.onLine,window.addEventListener("online",function(){this.online=!0}.bind(this)),window.addEventListener("offline",function(){this.online=!1}.bind(this)),await this.album.album.images.sort(((e,t)=>e.width*e.height-t.width*t.height));const e=this.album.album.images[0].url,t=await caches.open("albums-by-year-image-cache");let s=await t.match(e);if(void 0==s){s=await n.A.get(e,{responseType:"arraybuffer"});const a=Buffer.from(s.data,"binary").toString("base64");await t.put(e,new Response(JSON.stringify(a))),s=await t.match(e)}this.lazyCoverString=await s.json(),await this.album.album.images.sort(((e,t)=>Math.abs(e.width*e.height-9e4)-Math.abs(t.width*t.height-9e4))),this.albumCover=this.album.album.images[0].url}},T=S,B=(0,p.A)(T,x,A,!1,null,"3d034675",null),O=B.exports,L={components:{Album:O},props:["year","albums","album_types","search_query"],data(){return{expanded:!1}},computed:{sortedAlbums(){return this.albums.slice().sort(((e,t)=>{var s=e.album.release_date,a=t.album.release_date;return s>a?-1:s<a?1:0}))},visibleAlbums(){var e=this.albums.filter((e=>this.albumShown(e))).length;return this.$emit("filtered",e),e}},methods:{albumShown(e){return this.album_types[e.album.album_type].show&&(""==this.search_query||e.album.name.toLowerCase().includes(this.search_query.toLowerCase())||e.album.artists.map((e=>e.name.toLowerCase().includes(this.search_query.toLowerCase()))).some((e=>e)))}}},$=L,j=(0,p.A)($,C,k,!1,null,"aa42fc6e",null),P=j.exports,E={components:{ToggleGroup:g,Year:P},props:["access_token"],data(){return{albumsByYear:null,profile:null,album_types:{album:{show:!0,display:"Albums"},single:{show:!1,display:"Singles"},compilation:{show:!1,display:"Compilations"}},loadedAlbums:0,search_query:"",searchBoxContent:"",no_albums_shown:!1}},computed:{albums_request_url(){return"https://api.spotify.com/v1/me/albums?&limit=50&offset=0"},profile_request_url(){return"https://api.spotify.com/v1/me/?"},sortedAlbumYears(){return Object.keys(this.albumsByYear).sort(((e,t)=>t-e))},loaded(){return this.albumsByYear&&this.profile}},methods:{async loadProfile(){const e=await caches.open("albums-by-year-data-cache");var t=await e.match(this.profile_request_url);void 0==t&&(t=await n.A.get(this.profile_request_url+"&access_token="+this.access_token),await e.put(this.profile_request_url,new Response(JSON.stringify(t))),t=await e.match(this.profile_request_url));var s=await t.json();this.profile=s.data},async loadAlbums(){const e=await caches.open("albums-by-year-data-cache"),t=async function(s,a){var o=await e.match(s,{ignoreVary:!0});void 0==o&&(o=await n.A.get(s+"&access_token="+this.access_token),await e.put(s,new Response(JSON.stringify(o))),o=await e.match(s));var i=await o.json();for(var r of(i=i.data,this.loadedAlbums+=i.items.length,i.next&&await t(i.next,a),i.items))if(void 0!=r){const e=r["album"]["release_date"].split("-")[0];!a[e]&&(a[e]={year:e,albums:[]}),a[e]["albums"].push(r)}return this.$emit("loaded"),a}.bind(this);this.albumsByYear=await t(this.albums_request_url,{})},async refresh(){this.loadedAlbums=0,this.albumsByYear=null,this.profile=null,await caches.delete("albums-by-year-data-cache"),this.loadProfile(),this.loadAlbums()},updateSearchQuery(){this.search_query=this.searchBoxContent.trim()},searchQueryChange(e){var t=e.target.value;setTimeout((()=>{t==this.searchBoxContent&&this.updateSearchQuery(e)}),1e3)},clearSearchQuery(){this.searchBoxContent="",this.search_query=""},checkAlbumsShown(){this.no_albums_shown=Object.keys(this.albumsByYear).map((e=>this.albumsByYear[e].empty)).every((e=>e))}},async mounted(){this.loadProfile(),this.loadAlbums()}},Y=E,q=(0,p.A)(Y,r,l,!1,null,"cbfa44bc",null),N=q.exports,M={components:{Library:N},data(){return{scopes:["user-library-read"],client_id:"8c00d93547824017b1854018ed35bdef",access_token:null,theme:{icon:"moon",name:"dark",label:"Dark Theme"},refreshing:!1,online:!1,installPromptEvent:null}},computed:{authorised(){return!!this.access_token},authoriseURL(){return`https://accounts.spotify.com/authorize?client_id=${this.client_id}&response_type=token&redirect_uri=${location.protocol}//${location.host}${location.pathname}&scope=${this.scopes.join("%20")}`},desktop(){return!/Mobi/i.test(window.navigator.userAgent)}},methods:{async logout(){this.access_token=null,this.$cookies.remove("access_token"),await caches.delete("albums-by-year-data-cache"),await caches.delete("albums-by-year-image-cache")},install(){this.installPromptEvent.prompt(),this.installPromptEvent.userChoice.then((e=>{this.installPromptEvent=null,console.log(e)}))},async refresh(){this.$refs.library&&null!=this.$refs.library.albumsByYear&&(this.refreshing||this.online&&await n.A.get(`https://api.spotify.com/v1/me/?access_token=${this.access_token}`).then(async function(){this.refreshing=!0,this.$refs.library.refresh()}.bind(this)).catch(async function(){this.access_token=null,this.$cookies.remove("access_token"),await caches.delete("albums-by-year-data-cache"),await caches.delete("albums-by-year-image-cache"),window.location.replace(this.authoriseURL)}.bind(this)))},changeTheme(e){const t={system:{icon:"fill-drip",label:"System Theme"},dark:{icon:"moon",label:"Dark Theme"},pink:{icon:"ice-cream",label:"Pink Theme"}};if(Object.keys(t).indexOf(e)>0)this.theme.name=e;else{const e=Object.keys(t);this.theme.name=e[(e.indexOf(this.theme.name)+1)%e.length]}this.theme.icon=t[this.theme.name].icon,this.theme.label=t[this.theme.name].label,document.getElementsByTagName("html")[0].setAttribute("theme",this.theme.name),this.$cookies.set("theme",this.theme.name)}},async mounted(){this.online=navigator.onLine,window.addEventListener("online",function(){this.online=!0}.bind(this)),window.addEventListener("offline",function(){this.online=!1}.bind(this)),window.addEventListener("beforeinstallprompt",function(e){e.preventDefault(),this.installPromptEvent=e}.bind(this)),this.$cookies.isKey("access_token")&&(this.access_token=this.$cookies.get("access_token"));const e={};this.$route.hash.split("&").map((e=>e.replace("#",""))).forEach((t=>{const s=t.split("=");e[s[0]]=s[1]})),this.access_token=e.access_token?e.access_token:this.access_token,e.access_token&&this.$router.push(this.$route.path),this.authorised&&this.$cookies.set("access_token",this.access_token),this.$cookies.isKey("theme")?this.changeTheme(this.$cookies.get("theme")):this.changeTheme("dark")}},R=M,I=(0,p.A)(R,o,i,!1,null,null,null),Q=I.exports,J=s(173),z=s(1021),D=s(1659),F=s.n(D),G=s(7107),U=s(7875),V=s(1273),H=s(6188);G.Yv.add(U.Vz1),G.Yv.add(H.QLR,H.EZy,H.MjD,H.GRI,H.wIs,H.Pie,H.PJS,H.GxD,H.OtC,H.BwJ,H.$Dv,H.cbP,H.jPR,H.e68),a.Ay.component("font-awesome-icon",V.gc),a.Ay.component("font-awesome-layers",V.Vg);var K=s(3723);(0,K.k)("/albums-by-year/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}}),a.Ay.use(J.Ay);var W=new J.Ay({mode:"history",base:"/albums-by-year/",routes:[]});a.Ay.use(z.A,n.A),a.Ay.use(F()),a.Ay.$cookies.config(31536e4),a.Ay.config.productionTip=!1,new a.Ay({router:W,render:e=>e(Q)}).$mount("#app")}},t={};function s(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(i.exports,i,i.exports,s),i.loaded=!0,i.exports}s.m=e,function(){s.amdO={}}(),function(){var e=[];s.O=function(t,a,o,i){if(!a){var n=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],i=e[u][2];for(var r=!0,l=0;l<a.length;l++)(!1&i||n>=i)&&Object.keys(s.O).every((function(e){return s.O[e](a[l])}))?a.splice(l--,1):(r=!1,i<n&&(n=i));if(r){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[a,o,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.hmd=function(e){return e=Object.create(e),e.children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e}}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,i,n=a[0],r=a[1],l=a[2],c=0;if(n.some((function(t){return 0!==e[t]}))){for(o in r)s.o(r,o)&&(s.m[o]=r[o]);if(l)var u=l(s)}for(t&&t(a);c<n.length;c++)i=n[c],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(u)},a=self["webpackChunkalbums_by_year"]=self["webpackChunkalbums_by_year"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(930)}));a=s.O(a)})();
//# sourceMappingURL=app.d6fbb346.js.map